// ProblemLog Model Schema
// This is the source of truth for the ProblemLog model
// Uses: DeliveryStatus enum (defined in schema.prisma)
// Tracks delivery and submission history for each problem sent to each user
// Records: email delivery status, code submission status, retry attempts, errors
// Run: npm run prisma:combine to update schema.prisma

model ProblemLog {
  id               String         @id @default(cuid())
  userId           String
  userProviderServiceId String  // Reference to UserProviderService (instead of ProviderConfig)
  problemId        String
  status           DeliveryStatus @default(PENDING)
  sentAt           DateTime?
  emailSent        Boolean        @default(false)
  codeSubmitted    Boolean        @default(false)
  submissionResult String?
  errorMessage     String?
  retryCount       Int            @default(0)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  userProviderService UserProviderService @relation(fields: [userProviderServiceId], references: [id], onDelete: Cascade)
  problem           Problem            @relation(fields: [problemId], references: [id], onDelete: Cascade)

  @@unique([userId, userProviderServiceId, problemId])
}
