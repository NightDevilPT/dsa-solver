// ScheduledTask Model Schema
// This is the source of truth for the ScheduledTask model
// Uses: ScheduleType, TaskStatus, ProblemSelection enums (defined in schema.prisma)
// Run: npm run prisma:combine to update schema.prisma

model ScheduledTask {
  id               String            @id @default(cuid())
  userId           String
  userProviderServiceId String  // Reference to UserProviderService (instead of ProviderConfig)
  scheduleType     ScheduleType
  cronExpression   String?
  timezone         String            @default("UTC")
  status           TaskStatus        @default(PENDING)
  lastRunAt        DateTime?
  nextRunAt        DateTime?
  problemSelection ProblemSelection?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  userProviderService UserProviderService @relation(fields: [userProviderServiceId], references: [id], onDelete: Cascade)

  @@index([userId, status])
}
